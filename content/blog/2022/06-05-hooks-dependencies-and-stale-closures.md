---
title: "Hooks, Dependencies and Stale Closures"
date: 2022-06-05
tags:
  - react
  - ë²ˆì—­
  - NOT_READY
---

[ì›ë¬¸](https://tkdodo.eu/blog/hooks-dependencies-and-stale-closures)

dependencyë‚˜ hook ê°™ì€ ë‹¨ì–´ì˜ ë²ˆì—­ì€ ë¦¬ì•¡íŠ¸ ê³µì‹ë¬¸ì„œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼í•œ ë‹¨ì–´ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. (dependencyëŠ” ì˜ì¡´ì„±, hookì€ í›…, ê°ˆê³ ë¦¬ ë“±ì´ ì•„ë‹Œ hookìœ¼ë¡œ)

---

[í´ë¡œì €](<https://ko.wikipedia.org/wiki/%ED%81%B4%EB%A1%9C%EC%A0%80_(%EC%BB%B4%ED%93%A8%ED%84%B0_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D)>)ë¡œ ì‘ì—…í•˜ëŠ” ê²ƒì€ ê½¤ ê¹Œë‹¤ë¡œìš´ ì¼ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë¦¬ì—‘íŠ¸ì—ì„œ ì˜ì¡´ì„±ë¥¼ ê°€ì§„ hookì„ ë‹¤ë£°ë•Œ ê¹Œë‹¤ë¡œìš´ ì¼ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (useEffect, useMemo, useCallbackì„ ìƒê°í•´ ë³´ì„¸ìš”.) ë§ì€ ë²„ê·¸ì™€ ì¢Œì ˆë“¤ì´ (ë¦¬ì•¡íŠ¸ê°€ ìì²´ì ìœ¼ë¡œ ë„ì…í•œ ê²ƒì´ ì•„ë‹˜ì—ë„) í•´ë‹¹ ê°œë…ì— ë°€ì ‘í•˜ê²Œ ì—°ê´€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í´ë¡œì €ëŠ” ì˜¤íˆë ¤ hookì´ ì˜ì¡´í•˜ëŠ” ì–¸ì–´ ê°œë…ì…ë‹ˆë‹¤.

ì €ëŠ” Mark Eriksonì˜ ì´ ì§ˆë¬¸ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.

![mark-erikson-tweet](./assets/hook-closure-1.png)

(íŠ¸ìœ— ë²ˆì—­: ë¦¬ì•¡íŠ¸ ì»¤ë®¤ë‹ˆí‹°ì— ì§ˆë¬¸: "this ë°”ì¸ë”©ì´ ì–´ë–»ê²Œ ë™ì‘í•©ë‹ˆê¹Œ" ê°™ì€ ìœ í˜•ì˜ ì§ˆë¬¸ì´ "í´ë¡œì €ë¡œ ì¸í•´ stateê°€ ì˜¤ë˜ëœ(stale) ì´ìœ ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ" ê°™ì€ ìœ í˜•ì˜ ì§ˆë¬¸ìœ¼ë¡œ ë°”ë€ ê²ƒì€ ë” ì¢‹ì€ì§€, ë‚˜ìœì§€ í˜¹ì€ "ë™ì¼í•˜ì§€ë§Œ ë‹¤ë¥¸"ê°€ìš”?)

ë‚˜ëŠ” ê°œì¸ì ìœ¼ë¡œ ë” ì¢‹ì•„ì¡Œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì—ì„œ _this_ ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê³ í†µìŠ¤ëŸ¬ìš´ë°ë‹¤ ëŒ€ë¶€ë¶„ ëŸ°íƒ€ì„ì—ì„œ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤. ì´ì— ë°˜í•´, ì˜¤ë˜ëœ í´ë¡œì €ë¡œ ì¸í•´ ìƒê¸°ëŠ” ë™ì‘ë“¤ì€ ì¢€ ë” êµë¬˜í•˜ê³  ì—£ì§€ ì¼€ì´ìŠ¤ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê°€ì¥ í° ì´ì ì€ ì´ëŸ¬í•œ ë™ì‘ë“¤ì€ [react-hooks/exhaustive-deps](https://reactjs.org/docs/hooks-rules.html#eslint-plugin) eslint ê·œì¹™ì„ ì´ìš©í•´ ì •ì ìœ¼ë¡œ ë¶„ì„ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì´ í¬ìŠ¤íŠ¸ì—ì„œ ì €ëŠ” ì˜¤ë˜ëœ í´ë¡œì €ê°€ ë¬´ì—‡ì¸ì§€, ë¦¬ì•¡íŠ¸ì™€ hookê³¼ ì–´ë–¤ ê´€ë ¨ì´ ìˆëŠ”ì§€, ê·¸ë¦¬ê³  ì™œ lint ê·œì¹™ì´ ì¤‘ìš”í•´ì„œ í•´ë‹¹ ê·œì¹™ì„ _error_ ë¡œ ì„¤ì •í•´ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•´ ì„¤ëª…í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„  ì²«ë²ˆì§¸ë¡œ (ì˜¤ë˜ëœ) í´ë¡œì €ê°€ ë¬´ì—‡ì¸ì§€ë¶€í„° ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

# í´ë¡œì €ë€ ë¬´ì—‡ì¸ê°€

ì €ëŠ” í´ë¡œì €ì˜ ê°œë…ì„ ì„¤ëª…í•˜ê¸´ ë‹¤ì†Œ ì–´ë µë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. [MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Closures)ì˜ ì„¤ëª…ì„ ë³´ì‹œì£ :

> í´ë¡œì €ëŠ” í•¨ìˆ˜ì™€ í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ì–´íœ˜ì  í™˜ê²½(the lexical environment)ì˜ ì¡°í•©ì´ë‹¤. ì¦‰, í´ë¡œì €ëŠ” ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ì™¸ë¶€ í•¨ìˆ˜ì˜ ìŠ¤ì½”í”„ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•œë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í´ë¡œì €ëŠ” í•¨ìˆ˜ê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ í•¨ìˆ˜ê°€ ìƒì„±ë˜ëŠ” ì‹œì ì— ìƒì„±ëœë‹¤.

ì €ëŠ” ì´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿”ì„œ ë§í•˜ê² ìŠµë‹ˆë‹¤: ìë°”ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ëŠ” ìì‹ ì˜ ë°”ê¹¥ì— ì •ì˜ëœ í•¨ìˆ˜ë¥¼ "ë³´ê³ ", ìƒí˜¸ì‘ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ ëª¨ë¥´ì‹¤ ìˆ˜ë„ ìˆì§€ë§Œ ì´ ê°œë…ì„ êµ‰ì¥íˆ ìì£¼ ì“°ì‹¤ ê²ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì½œë°± í•¨ìˆ˜ ë‚´ì—ì„œ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ propsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—,

```js
// a-simple-closure

function Counter({ count }) {
  const logCount = () => {
    // ğŸ’¡ ì™¸ë¶€ ìŠ¤ì½”í”„ì—ì„œ countì— ì ‘ê·¼
    console.log("count", count);
  };

  return <button onClick={logCount}>Show me the count</button>;
}
```

_logCount_ ëŠ” _count_ prop ì²˜ëŸ¼ Counter ì»´í¬ë„ŒíŠ¸ì—ì„œ ì •ì˜í•œ ëª¨ë“  ìš”ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ë¥¼ ë¶€ëª¨ í•¨ìˆ˜ì˜ ì™¸ë¶€ë¡œ ì˜®ê²¨ë´„ìœ¼ë¡œì„œ í´ë¡œì €ì— ì˜ì¡´í•˜ê³  ìˆëŠ”ì§€ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ê°€ ë” ì´ìƒ ì‘ë™í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë” ì´ìƒ í´ë¡œì €ì— í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ í•´ë‹¹ ìš”ì†Œì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```js
// moving-it-up

// âŒ 'count' ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ. (no-undef)
const logCount = () => {
  console.log("count", count);
};
function Counter({ count }) {
  return <button onClick={logCount}>Show me the count</button>;
}
```

Reactì˜ í´ë¡œì €ì— ëŒ€í•œ ì¢‹ì€ ì ì€ ì»´í¬ë„ŒíŠ¸ê°€ ìƒˆ propìœ¼ë¡œ ë‹¤ì‹œ ë Œë”ë§ë˜ë©´ "ê·¸ëƒ¥ ì‘ë™"í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì¸í„°ë ‰í‹°ë¸Œ ì˜ˆì œë¥¼ ë³´ì„¸ìš”.
(ì—­ì£¼: í•´ë‹¹ ì˜ˆì œëŠ” ì‹¤ì œë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë¯€ë¡œ ì›ë¬¸ ë§í¬ë¥¼ í†µí•´ ì§ì ‘ ì²´í—˜í•´ ë³´ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.)

```js
function App() {
  const [count, increment] = React.useReducer(prev => prev + 1, 1);

  const logCount = () => {
    log(count);
  };

  return (
    <div>
      <div>count is {count}</div>
      <button onClick={increment}>increment</button>
      <button onClick={logCount}>log</button>
    </div>
  );
}

render(
  <div style={{ color: "black " }}>
    <App />
    <div id="result">log:</div>
  </div>
);

// ì¸í„°ë ‰í‹°ë¸Œ ì˜ˆì œì—ì„œ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ëŠ” ë°©ë²•
function log(value) {
  document.getElementById("result").innerHTML = "log: " + String(value);
}
```

ë‘ ë²„íŠ¼ì„ ëª¨ë‘ ì—¬ëŸ¬ë²ˆ í´ë¦­í•  ìˆ˜ ìˆê³  ë¡œê·¸ í•¨ìˆ˜ê°€ í´ë¡œì €ì— í¬í•¨ëœ countë¥¼ í†µí•´ í•­ìƒ "ìµœì‹ ì˜" countì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜¹ì€ ê·¸ë ‡ê²Œ ë³´ì…ë‹ˆë‹¤.

ê·¸ëŸ°ë° ì™œ ê·¸ëŸ´ê¹Œìš”? ê·¸ë¦¬ê³  í•­ìƒ ê·¸ëŸ´ê¹Œìš”?
